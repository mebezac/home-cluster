defaultPodOptions:
  securityContext:
    runAsNonRoot: true
    runAsUser: 3000
    runAsGroup: 3000
    fsGroup: 3000
    fsGroupChangePolicy: OnRootMismatch
    seccompProfile: { type: RuntimeDefault }

controllers:
  kitchenowl:
    annotations:
      reloader.stakater.com/auto: "true"
    initContainers:
      init-db:
        image:
          repository: ghcr.io/home-operations/postgres-init
          tag: 17.6
          pullPolicy: IfNotPresent
        envFrom: &envFrom
          - secretRef:
              name: kitchenowl-secret
    containers:
      app:
        image:
          repository: tombursch/kitchenowl
          tag: v0.7.3@sha256:8dda12a9a74483cec869f6816f6a340a1a20d9e6f483aeabebcb0c337c34c478
        env:
          TZ: America/New_York
          COLLECT_METRICS: false
          DB_DRIVER: postgresql
          EMAIL_MANDATORY: false
          FRONT_URL: https://kitchenowl.laboratory.casa
          OPEN_REGISTRATION: false
          STORAGE_PATH: "/data"
        envFrom: *envFrom
        resources:
          requests:
            cpu: 10m
            memory: 100Mi
          limits:
            memory: 500Mi

service:
  app:
    controller: kitchenowl
    ports:
      http:
        port: 8080

ingress:
  app:
    enabled: true
    className: internal
    hosts:
      - host: kitchenowl.laboratory.casa
        paths:
          - path: /
            service:
              identifier: app
              port: http

persistence:
  data:
    enabled: true
    type: persistentVolumeClaim
    storageClass: longhorn
    accessMode: ReadWriteOnce
    suffix: data
    size: 512Mi
    globalMounts:
      - path: /data
