defaultPodOptions:
  securityContext:
    runAsNonRoot: true
    runAsUser: 3000
    runAsGroup: 3000
    fsGroup: 3000
    fsGroupChangePolicy: OnRootMismatch
    seccompProfile: { type: RuntimeDefault }

controllers:
  mealie:
    annotations:
      reloader.stakater.com/auto: "true"
    initContainers:
      init-db:
        image:
          repository: ghcr.io/home-operations/postgres-init
          tag: 18.3
          pullPolicy: IfNotPresent
        envFrom: &envFrom
          - secretRef:
              name: mealie-secret
    containers:
      app:
        image:
          repository: ghcr.io/mealie-recipes/mealie
          tag: v3.11.0@sha256:d99fc2844c04288526d6cbecc9ac1b6c32d8ea6054236d56857107bbaf70ea5c
        env:
          TZ: America/New_York
          BASE_URL: https://mealie.laboratory.casa
          API_DOCS: false
          DB_ENGINE: postgres
          POSTGRES_PORT: 5432
        envFrom: *envFrom
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities: { drop: ["ALL"] }
        resources:
          requests:
            cpu: 100m
            memory: 400Mi
          limits:
            memory: 600Mi

service:
  app:
    controller: mealie
    ports:
      http:
        port: &port 9000

route:
  app:
    hostnames:
      - mealie.laboratory.casa
    parentRefs:
      - name: internal
        namespace: kube-system
        sectionName: https
    rules:
      - backendRefs:
          - identifier: app
            port: *port

persistence:
  data:
    enabled: true
    type: persistentVolumeClaim
    storageClass: longhorn
    accessMode: ReadWriteOnce
    suffix: data
    size: 1Gi
    globalMounts:
      - path: /app/data
  nltk-data:
    enabled: true
    type: emptyDir
    globalMounts:
      - path: /nltk_data
