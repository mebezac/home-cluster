---
defaultPodOptions:
  hostNetwork: true
  dnsPolicy: ClusterFirstWithHostNet

controllers:
  network-optimizer:
    containers:
      app:
        image:
          repository: ghcr.io/ozark-connect/network-optimizer
          tag: 1.0.10
        env:
          TZ: America/New_York
          BIND_LOCALHOST_ONLY: "false"
          APP_PASSWORD: ""
          DEMO_MODE_MAPPINGS: ""
          HOST_NAME: network-optimizer.laboratory.casa
          REVERSE_PROXIED_HOST_NAME: network-optimizer.laboratory.casa
          OPENSPEEDTEST_PORT: "3005"
          OPENSPEEDTEST_HOST: localhost
          OPENSPEEDTEST_HTTPS: "false"
          OPENSPEEDTEST_HTTPS_PORT: "443"
          Iperf3Server__Enabled: "false"
          Logging__LogLevel__Default: Information
          Logging__LogLevel__NetworkOptimizer: Information
        probes:
          liveness:
            enabled: true
            custom: true
            spec:
              httpGet:
                path: /api/health
                port: 8042
              initialDelaySeconds: 40
              periodSeconds: 30
              timeoutSeconds: 10
          readiness:
            enabled: true
            custom: true
            spec:
              httpGet:
                path: /api/health
                port: 8042
              initialDelaySeconds: 40
              periodSeconds: 30
              timeoutSeconds: 10
          startup:
            enabled: true
            custom: true
            spec:
              httpGet:
                path: /api/health
                port: 8042
              initialDelaySeconds: 40
              periodSeconds: 10
              failureThreshold: 30

  speedtest:
    containers:
      app:
        image:
          repository: ghcr.io/ozark-connect/speedtest
          tag: 1.0.10
        env:
          TZ: America/New_York
          HOST_NAME: network-optimizer.laboratory.casa
          OPENSPEEDTEST_PORT: "3005"
          OPENSPEEDTEST_HOST: network-optimizer.laboratory.casa
          OPENSPEEDTEST_HTTPS: "false"
          OPENSPEEDTEST_HTTPS_PORT: "443"
          REVERSE_PROXIED_HOST_NAME: network-optimizer.laboratory.casa

service:
  network-optimizer:
    controller: network-optimizer
    ports:
      http:
        port: 8042
  speedtest:
    controller: speedtest
    ports:
      http:
        port: 3000

ingress:
  network-optimizer:
    enabled: true
    className: internal
    hosts:
      - host: network-optimizer.laboratory.casa
        paths:
          - path: /
            service:
              identifier: network-optimizer
              port: http
  speedtest:
    enabled: true
    className: internal
    hosts:
      - host: speedtest.laboratory.casa
        paths:
          - path: /
            service:
              identifier: speedtest
              port: http

persistence:
  data:
    type: persistentVolumeClaim
    storageClass: longhorn
    accessMode: ReadWriteOnce
    size: 5Gi
    advancedMounts:
      network-optimizer:
        app:
          - path: /app/data
            subPath: data
  ssh-keys:
    type: persistentVolumeClaim
    storageClass: longhorn
    accessMode: ReadWriteOnce
    size: 100Mi
    advancedMounts:
      network-optimizer:
        app:
          - path: /app/ssh-keys
            subPath: ssh-keys
  logs:
    type: persistentVolumeClaim
    storageClass: longhorn
    accessMode: ReadWriteOnce
    size: 2Gi
    advancedMounts:
      network-optimizer:
        app:
          - path: /app/logs
            subPath: logs
