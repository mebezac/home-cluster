defaultPodOptions:
  securityContext:
    runAsNonRoot: true
    runAsUser: 3000
    runAsGroup: 3000
    fsGroup: 3000
    fsGroupChangePolicy: OnRootMismatch
    seccompProfile: { type: RuntimeDefault }

controllers:
  jotty:
    annotations:
      reloader.stakater.com/auto: "true"
    containers:
      app:
        image:
          repository: ghcr.io/fccview/jotty
          tag: 1.16.1@sha256:8ccf1e4fc6accc1fc49f69c4ba28799510ada1a005644c9db6c3f6fc52aabdef
        env:
          NODE_ENV: production
          PUID: 3000
          PGID: 3000
          APP_URL: https://jotty.laboratory.casa
          STOP_CHECK_UPDATES: yes
          TZ: America/New_York
        envFrom:
          - secretRef:
              name: jotty-secret
        resources:
          requests:
            cpu: 15m
            memory: 128M
          limits:
            memory: 512M

service:
  app:
    controller: jotty
    ports:
      http:
        port: 3000

ingress:
  app:
    className: external
    annotations:
      external-dns.alpha.kubernetes.io/target: external.laboratory.casa
    hosts:
      - host: jotty.laboratory.casa
        paths:
          - path: /
            service:
              identifier: app
              port: http

persistence:
  data:
    type: persistentVolumeClaim
    storageClass: longhorn
    accessMode: ReadWriteOnce
    size: 512Mi
    globalMounts:
      - path: /app/data
        subPath: data
      - path: /app/config
        subPath: config
  cache:
    type: emptyDir
    globalMounts:
      - path: /app/.next/cache
