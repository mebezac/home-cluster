defaultPodOptions:
  securityContext:
    runAsNonRoot: true
    runAsUser: 3000
    runAsGroup: 3000
    fsGroup: 3000
    fsGroupChangePolicy: OnRootMismatch
    seccompProfile: { type: RuntimeDefault }

controllers:
  valkey:
    type: statefulset
    containers:
      app:
        command: ["valkey-server", "/config/valkey.conf"]
        image:
          repository: valkey/valkey
          tag: 8.1.4-alpine@sha256:e706d1213aaba6896c162bb6a3a9e1894e1a435f28f8f856d14fab2e10aa098b
        resources:
          requests:
            cpu: 5m
            memory: 16Mi
          limits:
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities: { drop: ["ALL"] }

service:
  app:
    controller: valkey
    ports:
      valkey:
        port: 6379

persistence:
  data:
    type: persistentVolumeClaim
    storageClass: longhorn
    accessMode: ReadWriteOnce
    suffix: data
    size: 1Gi
    advancedMounts:
      valkey:
        app:
          - path: /data
  config:
    type: secret
    name: valkey-secret
    advancedMounts:
      valkey:
        app:
          - path: /config/valkey.conf
            subPath: valkey.conf
            readOnly: true
